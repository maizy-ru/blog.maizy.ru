<!DOCTYPE html>
<html lang="ru"
>
<head>
    <title>scala - blog.maizy.ru</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




    <meta name="author" content="Никита Ковалев" />
    <meta name="keywords" content="scala" />

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="blog.maizy.ru" />
        <meta property="og:type" content="website"/>
        <meta property="og:title" content="blog.maizy.ru"/>
        <meta property="og:url" content="http://blog.maizy.ru"/>
        <meta property="og:description" content="blog.maizy.ru"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.maizy.ru/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="http://blog.maizy.ru/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.maizy.ru/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.maizy.ru/theme/css/style.css" type="text/css"/>
        <link href="http://blog.maizy.ru/static/css/custom.css" rel="stylesheet">

        <link href="http://blog.maizy.ru/feeds/category/tech/atom.xml" type="application/atom+xml" rel="alternate"
              title="blog.maizy.ru"/>
        <link href="http://blog.maizy.ru/feeds/category/tech/rss.xml" type="application/rss+xml" rel="alternate"
              title="blog.maizy.ru"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.maizy.ru/" class="navbar-brand">
blog.maizy.ru            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://blog.maizy.ru/life">Life</a>
                        </li>
                        <li >
                            <a href="http://blog.maizy.ru/">Tech</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://blog.maizy.ru/archives"><i class="fa fa-th-list"></i><span class="icon-label">Архив</span></a></li>
              <li><a href="http://blog.maizy.ru/feeds/category/tech/rss.xml"><i class="fa fa-rss"></i><span class="icon-label">RSS</span></a></li>
              <li><a href="http://blog.maizy.ru/about"><i class="fa fa-bed"></i><span class="icon-label">О блоге</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-offset-1 col-md-10 col-lg-8 col-lg-offset-2">

            <article>
                <h2><a href="http://blog.maizy.ru/posts/handlerbars-templates-in-scala">Шаблонизация с handlebars и json4s на scala</a></h2>
                    <div class="article-info">
<footer class="post-info">
    <div class="published">
        <time datetime="2015-10-28T00:00:00+03:00"> 28.10.2015</time>
    </div>



<div class="tags">
<i class="fa fa-tags"></i>&nbsp;
	<a href="http://blog.maizy.ru/tag/scala">scala</a>
</div>
    
</footer><!-- /.post-info -->                    </div>
                <div class="summary"><p>Занимаюсь неспешно своим проектом <a href="https://github.com/scala-moscow/">scala.moscow</a>. Одна из задач – примитивный генератор статических сайтов. Очень хотелось чего-то простого для шаблонизации. Думал взять mustache, но оказалось, что это уже не совсем модно-молодёжно, так как есть его расширения handlebars и hogan.</p>
<p>Handlebars мне больше приглянулся. Для scala есть нативная реализация на парсер комбинаторах
<a href="https://github.com/mwunsch/handlebars.scala">handlebars.scala</a> и её <a href="https://github.com/gilt/handlebars.scala.fork">форк</a>. По фичам scala реализация очень ограничена, в частности, нет встроенной поддержки наследования шаблонов, которая в handlebars делается не силами шаблонизатора, а силами helper'ов. В итоге взял <a href="https://github.com/jknack/handlebars.java">handlebars.java</a>, который выглядит достаточно зрелым и имеет в составе, как минимум, helper'ы <code>partial</code> и <code>block</code> для наследования и i18n.</p>
<p>После выбора шаблонизатора встал вопрос как в него загружать данные. Встроенные резолверы не удобно использовать в scala, да и хотелось чего-то более простого, чем создания пачки классов-контейнеров для данных. А что есть проще для описания примитивных структур данных, чем JSON. Для scala нашёлся отличный DSL для JSON - <a href="http://json4s.org/">json4s</a>, у которого в частности есть такой лаконичный DSL:</p>
<div class="highlight"><pre><span class="k">import</span> <span class="nn">org.json4s.JsonDSL._</span>

<span class="k">val</span> <span class="n">data</span> <span class="k">=</span>
    <span class="o">(</span><span class="s">&quot;copyright&quot;</span> <span class="o">-&gt;</span>
      <span class="o">(</span><span class="s">&quot;year&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;2015&quot;</span><span class="o">)</span>
    <span class="o">)</span> <span class="o">~</span>
    <span class="o">(</span><span class="s">&quot;assets&quot;</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="s">&quot;path&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;/assets&quot;</span><span class="o">))</span> <span class="o">~</span>
    <span class="o">(</span><span class="s">&quot;title&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;scala.moscow&quot;</span><span class="o">)</span> <span class="o">~</span>
      <span class="o">(</span><span class="s">&quot;main&quot;</span> <span class="o">-&gt;</span>
        <span class="o">(</span><span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;main&quot;</span><span class="o">)</span>
      <span class="o">)</span> <span class="o">~</span>
      <span class="o">(</span><span class="s">&quot;about&quot;</span> <span class="o">-&gt;</span>
        <span class="o">(</span><span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;about&quot;</span><span class="o">)</span> <span class="o">~</span>
        <span class="o">(</span><span class="s">&quot;title&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;scala.moscow :: о проекте&quot;</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
</pre></div>


<p>Плюс к этому handlebars и задумывался для комбинации с JSON, что отражается в его синтаксисе. Плюс к этому сразу решается вопрос, где хранить статические данные, которые не нужно генерить программно –  в JSON файлах. В json4s конечно есть не только DSL, но и парсеры на основе нативной scala реализации и jackson.</p>
<p>Чтобы подружить handlebars.java и json4s DSL, написал <a href="https://github.com/scala-moscow/scala.moscow/blob/master/site-generator/src/main/scala/moscow/scala/sitegen/utils/template/JValueResolver.scala">ValueResolver</a>, идею и часть реализации подсмотрел у <a href="https://github.com/mfirry/handlebars-json4s/">handlebars-json4s</a>, но доработал её, решил часть проблем и дописал тестов. Как решу <a href="https://github.com/scala-moscow/scala.moscow/blob/4d31fad70f7bccd8097de21637f820375af41b52/site-generator/src/test/scala/moscow/scala/sitegen/tests/utils/template/JValueResolverSpec.scala#L86-L93">оставшиеся проблемы</a> планирую сделать отдельный артефакт.</p>
                </div>
                <a class="btn btn-default btn-xs" href="http://blog.maizy.ru/posts/handlerbars-templates-in-scala#comments">прокомментировать</a>
            </article>
            <hr/>
            <article>
                <h2><a href="http://blog.maizy.ru/posts/akka-cluster-testing">Akka. Тестирование в общем и про тестирование кластера в частности</a></h2>
                    <div class="article-info">
<footer class="post-info">
    <div class="published">
        <time datetime="2015-09-21T00:00:00+03:00"> 21.09.2015</time>
    </div>



<div class="tags">
<i class="fa fa-tags"></i>&nbsp;
	<a href="http://blog.maizy.ru/tag/akka">akka</a>
        /
	<a href="http://blog.maizy.ru/tag/scala">scala</a>
</div>
    
</footer><!-- /.post-info -->                    </div>
                <div class="summary"><p>Продолжая заниматься <a href="https://github.com/maizy/akka-cluster-heartbeat">hello world'ом на akka</a> погрузился в вопрос тестирования акторов.</p>
<p>Общие вещи просты, не вижу смысла пересказывать <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html">документацию</a>, остановлюсь только на ключевых моментах и выводах.</p>
<h3>Асинхронное vs синхронное тестирование</h3>
<p>Есть два подхода <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html#Synchronous_Unit_Testing_with_TestActorRef">синхронное</a> и <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html#Asynchronous_Integration_Testing_with_TestKit">асинхронное</a> тестирование. Первое в реальной жизни почти никогда не нужно, если только не хочется протестировать какие-то уж совсем внутренние кишки актора. В остальных случаях, лучше тестировать честно, отправляя и принимая ответы от акторов.</p>
<h3>TestProbe и TestActor</h3>
<p>Часть которую важно понимать. Сначала я думал, что при тестировании будет какая-то чёрная магия, которая позволит мне получать сообщения, летающие между разными акторами.</p>
<p>На деле всё проще. Внутри вашего TestCase создаётся TestProbe и TestActor, которые затем используются для запросов к акторам и анализа приходящих результатов. К сожалению, в документации сразу показывается пример с trait <code>ImplicitSender</code>, который слегка "гримирует" наличие testActor, что вызвало по началу повышенное количество wtf-per-line.</p>
<p>Соответственно <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html#Built-In_Assertions">набор стандартных assert'ов</a> на самом деле вызывается у стандартного TestProbe. Конечно же таких TestProbe можно даже <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html#Using_Multiple_Probe_Actors">создать несколько</a> и, например, поместить в них дополнительные специфичные вам assert'ы.</p>
<p>Отсюда же вывод, что для тестирования parent-child взаимодействия придётся вставлять между ними тестовый актор с проксированием сообщений, в документации <a href="http://doc.akka.io/docs/akka/2.3.14/scala/testing.html#Testing_parent-child_relationships">описаны способы сделать это</a>. В любом случае production код нужно немного к такому подготовить, другой вопрос, что изменения полезны и для других целей.</p>
<h3>Cluster testing</h3>
<p>С тестированием кластерных конфигурацию всё не так тривиально.</p>
<p>Для начала есть решение <a href="https://github.com/sbt/sbt-multi-jvm">multi-jvm тестирования с плагином для sbt</a>, в документации к akka описано как <a href="http://doc.akka.io/docs/akka/2.3.14/dev/multi-jvm-testing.html">это всё подружить с тестами</a>, чтобы <a href="http://doc.akka.io/docs/akka/2.3.14/dev/multi-node-testing.html">получить Multi Node Testing</a>. Пригодится и для других задач, когда используется просто akka remote.</p>
<p>Печалит, что нужно <a href="http://doc.akka.io/docs/akka/2.3.14/dev/multi-jvm-testing.html#multi-jvm-testing">серьёзно "испортить" конфиг sbt</a>, но, наверное, можно решить выносом таких тестов в отдельный sbt проект. Также ваша IntelliJ IDEA по понятным причинам про такие тесты ничего знать не будет, так как всё магия работает только в связке с sbt. Думаю, в ScalaIDE будет аналогично.</p>
<p>Простого способа дебажить это тоже нет. Логи не очень удобны, так как валяться в параллель со всех JVM. В идеале нужно писать обёртки, которые будут собирать их по каждой ноде отдельно.</p>
<h3>"... напоминает мне игру: "Что? Где? Когда?" называется! Непонятно, что где валяется и когда все это кончится!"</h3>
<p>Общерекомендуемый подход писать multi-jvm тесты в одном классе, который будет одинаково выполняться на всех нодах. Это обязывает постоянно следить за тем какой код и где исполняется. Например, написанный в лоб assert будет выполнен на всех нодах, часть из которых может быть ещё не присоединена к кластеру.</p>
<p>Постоянно об это спотыкался, но потом написал себе пару удобных утилиток:</p>
<div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
<span class="k">import</span> <span class="nn">org.scalatest.</span><span class="o">{</span> <span class="nc">BeforeAndAfterAll</span><span class="o">,</span> <span class="nc">Matchers</span><span class="o">,</span> <span class="nc">Suite</span> <span class="o">}</span>
<span class="k">import</span> <span class="nn">akka.cluster.Cluster</span>
<span class="k">import</span> <span class="nn">akka.cluster.ClusterEvent.</span><span class="o">{</span> <span class="nc">CurrentClusterState</span><span class="o">,</span> <span class="nc">MemberUp</span> <span class="o">}</span>
<span class="k">import</span> <span class="nn">akka.remote.testconductor.RoleName</span>
<span class="k">import</span> <span class="nn">akka.remote.testkit.</span><span class="o">{</span> <span class="nc">MultiNodeSpec</span><span class="o">,</span> <span class="nc">MultiNodeConfig</span><span class="o">,</span> <span class="nc">MultiNodeSpecCallbacks</span> <span class="o">}</span>
<span class="k">import</span> <span class="nn">akka.testkit.ImplicitSender</span>



<span class="k">abstract</span> <span class="k">class</span> <span class="nc">MultiNodeBaseSpec</span><span class="o">(</span><span class="n">config</span><span class="k">:</span> <span class="kt">MultiNodeConfig</span><span class="o">)</span>
  <span class="k">extends</span> <span class="nc">MultiNodeSpec</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
  <span class="k">with</span> <span class="nc">Suite</span>
  <span class="k">with</span> <span class="nc">BeforeAndAfterAll</span>
  <span class="k">with</span> <span class="nc">MultiNodeSpecCallbacks</span>
  <span class="k">with</span> <span class="nc">ImplicitSender</span>
  <span class="k">with</span> <span class="nc">Matchers</span>
<span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">beforeAll</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">super</span><span class="o">.</span><span class="n">beforeAll</span><span class="o">()</span>
    <span class="n">multiNodeSpecBeforeAll</span><span class="o">()</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">afterAll</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">enterBarrier</span><span class="o">(</span><span class="s">&quot;before-clean-up&quot;</span><span class="o">)</span>
    <span class="n">cleanUp</span><span class="o">()</span>
    <span class="n">enterBarrier</span><span class="o">(</span><span class="s">&quot;clean-up&quot;</span><span class="o">)</span>
    <span class="n">multiNodeSpecAfterAll</span><span class="o">()</span>
    <span class="k">super</span><span class="o">.</span><span class="n">afterAll</span><span class="o">()</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">cluster</span><span class="k">:</span> <span class="kt">Cluster</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">(</span><span class="n">system</span><span class="o">)</span>
  <span class="n">cluster</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="n">testActor</span><span class="o">,</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">MemberUp</span><span class="o">])</span>
  <span class="n">expectMsgClass</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">CurrentClusterState</span><span class="o">])</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;myself address: </span><span class="si">${</span><span class="n">node</span><span class="o">(</span><span class="n">myself</span><span class="o">).</span><span class="n">address</span><span class="si">}</span><span class="s">, role: </span><span class="si">${</span><span class="n">myself</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">currentClusterNodes</span> <span class="k">=</span> <span class="n">mutable</span><span class="o">.</span><span class="nc">Set</span><span class="o">[</span><span class="kt">RoleName</span><span class="o">]()</span>

  <span class="k">def</span> <span class="n">joinToCluster</span><span class="o">(</span><span class="n">nodes</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">RoleName</span><span class="o">],</span> <span class="n">seedNode</span><span class="k">:</span> <span class="kt">RoleName</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">currentClusterNodes</span> <span class="o">++=</span> <span class="n">nodes</span>
    <span class="c1">// on new nodes await events for all cluster member</span>
    <span class="n">runOn</span><span class="o">(</span><span class="n">nodes</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">cluster</span> <span class="n">join</span> <span class="n">node</span><span class="o">(</span><span class="n">seedNode</span><span class="o">).</span><span class="n">address</span>
      <span class="o">(</span><span class="n">receiveN</span><span class="o">(</span><span class="n">currentClusterNodes</span><span class="o">.</span><span class="n">size</span><span class="o">).</span><span class="n">collect</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">MemberUp</span><span class="o">(</span><span class="n">member</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">address</span> <span class="o">}.</span><span class="n">toSet</span>
        <span class="n">should</span> <span class="n">contain</span> <span class="n">theSameElementsAs</span> <span class="n">currentClusterNodes</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">node</span><span class="o">(</span><span class="k">_</span><span class="o">).</span><span class="n">address</span><span class="o">).</span><span class="n">toSet</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="c1">// on existing nodes await events for only new cluster members</span>
    <span class="n">runOn</span><span class="o">((</span><span class="n">currentClusterNodes</span> <span class="o">--</span> <span class="n">nodes</span><span class="o">.</span><span class="n">toSet</span><span class="o">).</span><span class="n">toList</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">(</span><span class="n">receiveN</span><span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">size</span><span class="o">).</span><span class="n">collect</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">MemberUp</span><span class="o">(</span><span class="n">member</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">address</span> <span class="o">}.</span><span class="n">toSet</span>
        <span class="n">should</span> <span class="n">contain</span> <span class="n">theSameElementsAs</span> <span class="n">nodes</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">node</span><span class="o">(</span><span class="k">_</span><span class="o">).</span><span class="n">address</span><span class="o">).</span><span class="n">toSet</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="n">enterBarrier</span><span class="o">(</span><span class="s">&quot;join-&quot;</span><span class="o">+</span> <span class="n">nodes</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span><span class="o">).</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">runOnJoinedNodes</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
    <span class="n">runOn</span><span class="o">(</span><span class="n">currentClusterNodes</span><span class="o">.</span><span class="n">toList</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">a</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="n">cleanUp</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">(</span><span class="n">testActor</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>


<p>В базовом spec'е выше реализовано:</p>
<ul>
<li>подписывание на события кластера</li>
<li>метод <code>joinToCluster</code> для правильного присоединения к кластеру нод</li>
<li>метод <code>runOnJoinedNodes</code> для выполнения кода на уже работающих нодах кластера, аналогичный по использованию <a href="http://doc.akka.io/docs/akka/2.3.14/dev/multi-node-testing.html#A_Multi_Node_Testing_Example">встроенному <code>runOn</code></a></li>
</ul>
<h3>Тестирование сети</h3>
<p>Есть встроенная поддержка тестирования транспорта и сети с возможностью эмуляции проблем между нодами (blackhole). При этом я надеюсь как-нибудь попробовать приспособить docker, его API и iptables для данных целей, благо multi-jvm, кажется умеет сам в тестах упаковывать тестовую ноду в jar, раскладывать через ssh+rsync, а затем запускать.</p>
<h3>Примеры</h3>
<p>Можно глянуть, что <a href="https://github.com/maizy/akka-cluster-heartbeat/tree/master/src/multi-jvm/scala">получилось у меня</a>. Много полезных примеров я обнаружил в <a href="https://github.com/akka/akka/tree/master/akka-cluster/src/multi-jvm/scala/akka/cluster">самих исходниках akka</a> и <a href="https://github.com/jboner/akka-crdt/tree/master/src/multi-jvm/scala/akka/crdt/convergent">в проекте akka crdt</a>.</p>
<h3>Вывод</h3>
<p>Тестировать akka, даже в сложных конфигурациях можно и нужно, но tooling ещё требует доработки.</p>
                </div>
                <a class="btn btn-default btn-xs" href="http://blog.maizy.ru/posts/akka-cluster-testing#comments">прокомментировать</a>
            </article>
            <hr/>
            <article>
                <h2><a href="http://blog.maizy.ru/posts/fpconf-2015">FPConf 2015 - заметки на полях</a></h2>
                    <div class="article-info">
<footer class="post-info">
    <div class="published">
        <time datetime="2015-08-17T00:00:00+03:00"> 17.08.2015</time>
    </div>



<div class="tags">
<i class="fa fa-tags"></i>&nbsp;
	<a href="http://blog.maizy.ru/tag/conference">conference</a>
        /
	<a href="http://blog.maizy.ru/tag/scala">scala</a>
</div>
    
</footer><!-- /.post-info -->                    </div>
                    <img src="/static/images/fpconf_logo.png" alt="article featured image" class="img-responsive pull-right article-image"/>
                <div class="summary"><p>Побывал на конференции <a href="http://fpconf.ru/">FPConf</a>. Поделюсь своими мыслями, возникшими при прослушивании докладов. Я в основном сидел на втором потоке, где было про scala, UI и пр. Первый поток был преимущественно про Erlang и Haskell.</p>
<p>Организаторы обещали, что будет видео, надеюсь пополнить эту статью ссылкам в будущем.</p>
<h3>Cамурайский путь молодого scala-программиста, Сергей Лобин, Sputnik.ru</h3>
<p>В докладе было мало про scala, больше про проблемы при разработки геокодера в Спутнике. Главный печальный для всех фанатов Scala вывод – Scala в production и них не прижилась, найти разработчиков сложно, Go разработчиков найти значительно проще.</p>
<h3>Макросы scala, Михаил Муцянко, JetBrains</h3>
<p>Хороший вводный доклад про макросы Scala от разработчика <a href="http://blog.jetbrains.com/scala/">Scala plugin в IDEA</a>.</p>
<p>Из запомнившегося:</p>
<p>Удобный способ построения AST в макросе через <a href="http://docs.scala-lang.org/overviews/quasiquotes/intro.html">Q интерполятор</a> (квазикватирование).</p>
<p>Килер фича, когда Михаил нажатием одной волшебной кнопки прямо в IDEA, показал как разворачивается макрос в Scala код. К сожалению оказалось, что это не из production версии плагина и вроде ожидать такое в ближайшее время не стоит, так как работает не всегда корректно. Очень вкусная возможность, будем ждать.</p>
<p>В 2.12 ожидается значительное улучшение в деле разработки макросов за счёт нового проекта <a href="http://scalameta.org/">ScalaMeta</a>.</p>
<p>Хорошая ссылка на изучение: What Are Macros Good For? от Евгения Бурмако <a href="http://www.youtube.com/watch?v=4Rxo_7lrb7Y">YouTube</a>, <a href="http://scalamacros.org/paperstalks/2013-07-17-WhatAreMacrosGoodFor.pdf">слайды</a>. BTW про самого Евгения и его работу над Scala макросами можно узнать в <a href="http://eax.me/eaxcast-s02e10/">EaxCast S02E10</a>.</p>
<p>Доклад рекомендую к просмотру.</p>
<h3>Встраивание языка в строковой интерполятор, Михаил Лиманский, ЭСК</h3>
<p>Хороший практический доклад, как вместо DSL порой можно обойтись интерполятором. Какие возможности, плюсы и минусы такого подхода. Можно прямо брать доклад и писать свой интерполятор как по tutorial'у.</p>
<p>В качестве домашнего задания для себя запомнил задачу реализовать интерполятор для типобезопасного форматирования строки. Хотим с <a href="http://habrahabr.ru/users/aveic/">aveic</a> попробовать независимо друг от друга реализовать это и посмотреть, что получиться.</p>
<p>Рекомендую для тех, кто интересуется темой.</p>
<h3>Lenses And Prisms, Эдвард Кметт</h3>
<p>Самый звёздный докладчик на конференции. К сожалению без знания хотя бы основ синтаксиса Haskell понять что-то было сложно. Докладчик проводил доклад в потрясающей форме - выдавая как из пулемёта кучу кода на Haskell прями в vim'е.</p>
<p>Чтобы понять что к чему, я смотрел на порт этой библиотеки на Scala - <a href="https://github.com/julien-truffaut/Monocle">Monocle</a>.</p>
<p>В общих словах – это удобный способ изменения иммутабельных структур с возможностью написания максимально абстрактных маленьких кусочков с дальнейшим комбинированием в более сложные кусочки.</p>
<h3>Реактивные потоки в backend-е, Алексей Романчук, 2ГИС</h3>
<p>Хорошая success story про использование akka streams в production. Для меня теперь это один из ответов на вопрос «где нам нужна akka?».</p>
<p>Забавные слайды с цветными "сосиками".</p>
<p>Прозвучавшее число потерь на akka streams по сравнению с голыми акторами ~10%.</p>
<p>Рекомендую всем, кому интересны akka streams.</p>
<h3>Scala performance для сомневающихся, Роман Гребенников, Sociohub.ru</h3>
<p>Самый запомнившийся доклад. Покрывает сразу две темы - пару примеров того как все модные молодёжные FP штуки из scala отражаются в bytecode JVM и машинном коде, какие потери они за собой несут или не несут. А также способы самому развернуть, померить и понять как выполняется тот или иной код.</p>
<p>Вкратце про проблемы – простой pattern matching по типу параметра - также быстро как колбаса из if'ов. Есть проблемы с boxing/unboxing в Scala collection и прикладывать <a href="http://www.scala-lang.org/api/2.11.4/index.html#scala.specialized">@specialized</a> не поможет.</p>
<p>Рекомендую к просмотру.</p>
<h3>В общем</h3>
<p>Очень приятное послевкусие от конференции, не ожидал, что про FP будет так целостно. Как сказали организаторы было 180 человек.</p>
<p>Не посмотрел в живую «Фронтэнд без грусти» Никиты Прокопова, о котором наслышан от коллег, которые видели доклад на какой-то другой конференции. А также хочется поглядеть на «Aрхитектура UI на основе функциональных линз» от Ильи Беда.</p>
<p>Буду ждать видео.</p>
                </div>
                <a class="btn btn-default btn-xs" href="http://blog.maizy.ru/posts/fpconf-2015#comments">прокомментировать</a>
            </article>
            <hr/>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row footnotes">
         <div class="col-xs-10">&copy; 2015 Никита Ковалев
            &middot; Powered by <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>
            &middot; Theme <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>.         </div>
        <div class="col-xs-2">
          <p class="pull-right">
            <i class="fa fa-rss"></i>
            <a href="http://blog.maizy.ru/feeds/category/tech/rss.xml">rss</a>
          </p>
        </div>
      </div>
   </div>
</footer>
<script src="http://blog.maizy.ru/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.maizy.ru/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.maizy.ru/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'blogmaizyru'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-392618-8', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->

</body>
</html>